### AMQP转存器  
AMQP转存器可以实时拉取基于AMQP协议服务器中的数据并将其转存到缓冲文件中去。  本插件对支持AMQP协议的消息中间件（如：RabbitMQ）支持多维队列扫描，每次数据拉取将遍历配置中指定多个队列，将多个队列中的数据拉取出来写入下游缓冲区。与其它转存器插件类同，如果转存缓冲文件尺寸超过阈值则按数字递增序列滚动，这区别于log4j的重命名方式。虽然转存器支持对下游ETL通道的推送实现，但是考虑到这总机制不利于数据安全，同时易引发通道OOM错误，故现有的转存器实现都是基于转存文件缓冲的，而非通道。 
转存器与收集器的一个最大区别在于：收集器应用的数据源主要是存储或数据库，而转存器应用的数据源主要是来自日志文件、消息中间件或实时服务客户端。前者数据源中的数据是被转存器主动拉取，而后者数据源中的数据是被主动推送给转存器。  
      

### 下载与安装  
wget https://github.com/lixiang2114/DataFlow-Plugins/raw/main/AmqpTransfer/dst/amqpTransfer.zip -d /install/zip/  
unzip  /install/zip/amqpTransfer.zip -d /software/DataFlow-3.0/plugins/    

##### 备注：  
插件配置路径：  
 /software/DataFlow-3.0/plugins/amqpTransfer/transfer.properties  
      
### 参数值介绍  
|参数名称|参数含义|缺省默认|备注说明|
|:-----:|:-------:|:-------:|:-------:|
|virHost|虚拟主机|无|本插件登录AMQP单点或集群服务器的虚拟主机名称|
|hostList|连接地址列表|127.0.0.1:5672|用于本插件连接AMQP服务端的地址(单点)或地址列表(集群)|
|passWord|登录密码|无|本插件登录AMQP服务器的密码，该参数是必填参数|
|userName|登录用户|无|本插件登录AMQP服务器的用户名，该参数是必填参数|
|routeBinds|路由绑定列表|无|本插件用于定义AMQP服务端路由拓扑架构的路由绑定表|
|targetQueues|扫描队列|无|必选参数，指定扫描的目标队列表，多个队列名之间用英文逗号分隔|
|pollTimeoutMills|批次超时|100|本插件客户端每次扫描拉取数据时等待的最大超时时间(单位:毫秒)|
|transferSaveFile|转存文件|buffer.log.0|转存的目标缓冲文件，目标缓冲文件超过阈值尺寸则按数字递增滚动|
|delRoutingOnExit|删除路由|false|指定在插件线程退出后是否删除AMQP服务器上的路由拓扑架构|
|transferSaveMaxSize|转存尺寸|2GB|转存目标缓冲文件的最大阈值尺寸，目标缓冲文件尺寸单位可选|

##### 备注：  
1. 路由拓扑架构定义在AMQP组件的Sink插件中也有相同的定义，这并不矛盾。因为在交换器、队列和绑定存在时，重复添加这些组件到AMQP服务端是幂等操作；同时不建议将delRoutingOnExit参数设置为true，因为可能有除DataFlow系统框架以外的第三方组件共享相同的队列或交换器    
2. transferSaveFile参数的默认值buffer.log.0所在路径是系统安装目录下flows子目录中对应流程实例目录下的share子目录，目标数据文件仅按尺寸实现滚动记录，当尺寸超过设定的阈值将按数字递增序列创建新的目标数据文件流，从而完成文件切换操作。  
3. 原则上只要AMQP服务器上定义了对应的队列，那么本插件连接AMQP服务器就不会有问题，但不保证一定能够拉取到队列中的数据，因为这还取决于连接的队列在AMQP服务器上是否绑定了相应的路由和交换器。  